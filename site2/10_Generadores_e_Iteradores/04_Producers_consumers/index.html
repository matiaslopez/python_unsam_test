<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://matiaslopez.github.io/python_unsam_test/10_Generadores_e_Iteradores/04_Producers_consumers/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>04 Producers consumers - Programación en Python</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "04 Producers consumers";
    var mkdocs_page_input_path = "10_Generadores_e_Iteradores/04_Producers_consumers.md";
    var mkdocs_page_url = "/python_unsam_test/10_Generadores_e_Iteradores/04_Producers_consumers/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Programación en Python</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Welcome to MkDocs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">01 Introduccion</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/01_Python/">01 Python</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/02_Hello_world/">02 Hello world</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/03_Numeros/">03 Numeros</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/04_Strings/">04 Strings</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/05_Listas/">05 Listas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../01_Introduccion/06_CierreClase/">06 CierreClase</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">02 Estructuras y Funciones</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../02_Estructuras_y_Funciones/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../02_Estructuras_y_Funciones/01_Archivos/">01 Archivos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../02_Estructuras_y_Funciones/02_Funciones/">02 Funciones</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../02_Estructuras_y_Funciones/03_TiposDatos/">03 TiposDatos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../02_Estructuras_y_Funciones/04_Contenedores/">04 Contenedores</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../02_Estructuras_y_Funciones/05_CierreClase/">05 CierreClase</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">03 Datos</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/01_Bugs/">01 Bugs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/02_Secuencias/">02 Secuencias</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/03_Contadores/">03 Contadores</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/04_IDE/">04 IDE</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/05_Formato/">05 Formato</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/06_Arboles1/">06 Arboles1</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../03_Datos/07_CierreClase/">07 CierreClase</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">04 Listas y Listas</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/01_Debugger/">01 Debugger</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/02_IteradoresLista/">02 IteradoresLista</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/03_Comprension_Listas/">03 Comprension Listas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/04_Objetos/">04 Objetos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/05_Arboles2_LC/">05 Arboles2 LC</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../04_Listas_y_Listas/06_Cierre/">06 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">05 Random Plt Dbg</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../05_Random_Plt_Dbg/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../05_Random_Plt_Dbg/01_Random/">01 Random</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../05_Random_Plt_Dbg/02_NumPy_Arrays/">02 NumPy Arrays</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../05_Random_Plt_Dbg/03_Figuritas/">03 Figuritas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../05_Random_Plt_Dbg/04_Arboles3_plt/">04 Arboles3 plt</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../05_Random_Plt_Dbg/05_Cierre/">05 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">06 Organización y Complejidad</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/01_Repaso/">01 Repaso</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/02_Scripts/">02 Scripts</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/03_Funciones/">03 Funciones</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/04_Modulos/">04 Modulos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/05_BusqBinaria/">05 BusqBinaria</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/06_Complejidad/">06 Complejidad</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/07_gr%C3%A1ficos_de_complejidad/">07 gráficos de complejidad</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../06_Organizaci%C3%B3n_y_Complejidad/08_Cierre/">08 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">07 Plt Especificacion y Documentacion</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/01_Repaso/">01 Repaso</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/02_Excepciones/">02 Excepciones</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/03_Modulo_principal/">03 Modulo principal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/04_Flexibilidad/">04 Flexibilidad</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/05_Especificacion_y_Documentacion/">05 Especificacion y Documentacion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/06_Estilo/">06 Estilo</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/07_Matplotlib/">07 Matplotlib</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../07_Plt_Especificacion_y_Documentacion/08_Cierre/">08 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">08 Fechas Carpetas y Pandas</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/01_Intro/">01 Intro</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/02_Fechas/">02 Fechas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/03_Archivos_y_Directorios/">03 Archivos y Directorios</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/04_Ordenando_archivos/">04 Ordenando archivos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/05_Pandas/">05 Pandas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/06_Series_Temporales/">06 Series Temporales</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../08_Fechas_Carpetas_y_Pandas/07_Cierre/">07 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">09 Clases y Objetos</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/01_Intro/">01 Intro</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/02_Clases/">02 Clases</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/03_Herencia/">03 Herencia</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/04_M%C3%A9todos_Especiales/">04 Métodos Especiales</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/05_Pilas_Colas/">05 Pilas Colas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/06_Teledeteccion/">06 Teledeteccion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../09_Clases_y_Objetos/07_Cierre/">07 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">10 Generadores e Iteradores</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../01_Intro/">01 Intro</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../02_protocolo_Iteracion/">02 protocolo Iteracion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../03_iteracion_a_medida/">03 iteracion a medida</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">04 Producers consumers</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#sistemas-productor-consumidor">Sistemas productor-consumidor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#pipelines-con-generadores">Pipelines con generadores</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ejercicios">Ejercicios</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ejercicio-108-configuremos-un-pipeline-simple">Ejercicio 10.8: Configuremos un pipeline simple</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ejercicio-109-un-pipeline-mas-en-serio">Ejercicio 10.9: Un pipeline más en serio</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ejercicio-1010-un-pipeline-mas-largo">Ejercicio 10.10: Un pipeline más largo</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ejercicio-1011-filtremos-los-datos">Ejercicio 10.11: Filtremos los datos</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ejercicio-1012-el-pipeline-ensamblado">Ejercicio 10.12: El pipeline ensamblado</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#discusion">Discusión</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../05_Mas_generadores/">05 Mas generadores</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../06_PredadorPresa/">06 PredadorPresa</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../07_Cierre/">07 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">11 Recursion</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/01_Introduccion/">01 Introduccion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/02_Recursion/">02 Recursion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/03_Diseno_Recursivo/">03 Diseno Recursivo</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/05_EjerciciosRec/">05 EjerciciosRec</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/05_Regresion_Lineal/">05 Regresion Lineal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../11_Recursion/06_Cierre/">06 Cierre</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">12 Ordenamiento</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../12_Ordenamiento/00_Resumen/">00 Resumen</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../12_Ordenamiento/01_Introduccion/">01 Introduccion</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../12_Ordenamiento/02_Ordenamiento_sencillo/">02 Ordenamiento sencillo</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../12_Ordenamiento/03_Divide_and_Conquer/">03 Divide and Conquer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../12_Ordenamiento/04_introduccion_al_AA/">04 introduccion al AA</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../12_Ordenamiento/05_Cierre/">05 Cierre</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Programación en Python</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>10 Generadores e Iteradores &raquo;</li>
        
      
    
    <li>04 Producers consumers</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <p><a href="../Contenidos.md">Contenidos</a> | <a href="../03_iteracion_a_medida/">Anterior (3 Iteración a medida)</a> | <a href="../05_Mas_generadores/">Próximo (5 Más sobre generadores)</a></p>
<h1 id="104-productores-consumidores-y-canerias">10.4 Productores, consumidores y cañerías.</h1>
<p>Para esta sección hay un <a href="https://youtu.be/CSFc1Z__1hA">video introductorio</a>.</p>
<p>Los generadores son una herramienta muy útil para configurar pipelines (cañerías). Este concepto requiere una breve <em>aclaración</em>: Un pipeline tradicional en computación consta de una serie de programas y archivos asociados que constituyen una estructura de procesamiento de datos, donde cada programa se ejecuta independientemente de los demás, pero juntos resultan en un flujo conveniente de datos a través de los archivos asociados desde un "productor" (una cámara, un sensor, un lector de código de barras) hasta un "consumidor" (un graficador, un interruptor eléctrico, un log de una página web). Construiste un pequeño pipeline en la sección anterior, usando <code>vigilante.py</code>.  </p>
<p>En esta sección hablaremos de cómo implementar estas estructuras de productores y consumidores de datos con generadores en Python.</p>
<h3 id="sistemas-productor-consumidor">Sistemas productor-consumidor</h3>
<p>El concepto de generadores está íntimamente asociado a problemas de tipo productor-consumidor en sus varias formas. Fijate esta estructura, que es típica de muchos programas:</p>
<pre><code class="language-python"># Productor
def vigilar(f):
    ...
    while True:
        ...
        yield linea        # Produce/obtiene valores para &quot;linea&quot;
        ...

# Consumidor
for linea in vigilar(f):    # Consume líneas del `yield`
    ...
</code></pre>
<p>Los <code>yield</code> generan los datos que los <code>for</code> consumen.</p>
<h3 id="pipelines-con-generadores">Pipelines con generadores</h3>
<p>Podés usar esta característica de los generadores para construír <em>pipelines</em> que procesen tus datos, un concepto que es muy usado en Unix (pipes) pero en Windows se usa menos.</p>
<p><em>productor</em> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <em>consumidor</em></p>
<p>Los <em>pipelines</em> de procesamiento de datos tienen un productor al comienzo, una cadena de etapas de procesamiento y un consumidor al final.</p>
<p><strong>productor</strong> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <em>consumidor</em></p>
<pre><code class="language-python">def productor():
    ...
    yield item
    ...
</code></pre>
<p>El productor es en general un generador, aunque tambien podría ser una lista o cualquier otra secuencia iterable.</p>
<p>El <code>yield</code> alimenta al pipeline de datos.</p>
<p><em>productor</em> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <strong>consumidor</strong></p>
<pre><code class="language-python">def consumidor(s):
    for item in s:
        ...
</code></pre>
<p>El consumidor es un ciclo <code>for</code>. Obtiene los elementos <code>item</code> y los usa para algo.</p>
<p><em>productor</em> &rarr; <strong>procesamiento</strong> &rarr; <strong>procesamiento</strong> &rarr; <em>consumidor</em></p>
<pre><code class="language-python">def procesamiento(s):
    for item in s:
        ...
        yield itemnuevo
        ...
</code></pre>
<p>Las etapas intermedias de procesamiento simultáneamente consumen y producen datos, pueden alterar el flujo de datos, eliminar o modificar datos según su función.</p>
<p><em>productor</em> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <em>consumidor</em></p>
<pre><code class="language-python">def productor():
    ...
    yield item          # yield devuelve un item que será recibido por `procesamiento`
    ...

def procesamiento(s):
    for item in s:      # item viene del `productor`
        ...
        yield newitem   # este yield devuelve un nuevo item
        ...

def consumidor(s):
    for item in s:      # item viene de `procesamiento`
        ...
</code></pre>
<p>Vamos a construír un pipeline con la siguiente arquitectura:</p>
<pre><code class="language-python">a = productor()
b = procesamiento(a)
c = consumidor(b)
</code></pre>
<p>Como te darás cuenta, los datos van pasando de una función a la siguiente.</p>
<h2 id="ejercicios">Ejercicios</h2>
<p>Para este ejercicio, necesitás que el programa <code>sim_mercado.py</code> aún esté corriendo. Vas a usar la función <code>vigilar()</code> que escribiste en el <a href="../03_iteracion_a_medida/#ejercicio-107-cambios-de-precio-de-un-camión">Ejercicio 10.7</a></p>
<h3 id="ejercicio-108-configuremos-un-pipeline-simple">Ejercicio 10.8: Configuremos un pipeline simple</h3>
<p>Escribí la siguiente función y veamos como funciona un pipeline.</p>
<pre><code class="language-python">&gt;&gt;&gt; def filematch(lines, substr):
        for line in lines:
            if substr in line:
                yield line

&gt;&gt;&gt;
</code></pre>
<p>Esta función es casi idéntica al primer ejemplo de generador en el ejercicio anterior, salvo que ya no abre un archivo sino que opera directamente de una secuencia de líneas que recibe como argumento. Ahora probá lo siguiente:</p>
<pre><code class="language-python">&gt;&gt;&gt; lines = vigilar('../Data/mercadolog.csv')
&gt;&gt;&gt; naranjas = filematch(lines, 'Naranja')
&gt;&gt;&gt; for line in naranjas:
        print(line)

... esperá que aparezca la salida ...
</code></pre>
<p>Puede pasar que tarde unos segundos en darte una salida, pero vas a ver información sobre naranjas tan pronto como sean añadidas al archivo por el primer generador.</p>
<h3 id="ejercicio-109-un-pipeline-mas-en-serio">Ejercicio 10.9: Un pipeline más en serio</h3>
<p>Llevemos esta idea un poco más lejos. Probemos esto:</p>
<pre><code class="language-python">&gt;&gt;&gt; from vigilante import vigilar
&gt;&gt;&gt; import csv
&gt;&gt;&gt; lineas = vigilar('../Data/mercadolog.csv')
&gt;&gt;&gt; filas = csv.reader(lineas)
&gt;&gt;&gt; for fila in filas:
        print(fila)

...   
['Rabanito', ' 249.37', ' 357']
['Batata', ' 15.75', ' 1040']
['Rabanito', ' 211.31', ' 324']
['Zuccini', ' 83.12', ' 612']
...
</code></pre>
<p>¡Interesante!  La salida de la función <code>vigilar()</code> fué usada como entrada a la función <code>csv.reader()</code> (que habíamos usado para leer un archivo del disco) y el resultado es una secuencia de filas "parseadas", separadas por las comas. </p>
<h3 id="ejercicio-1010-un-pipeline-mas-largo">Ejercicio 10.10: Un pipeline más largo</h3>
<p>Veamos si podemos construír un pipeline más largo basado en la misma idea.</p>
<p>Creá un archivo nuevo llamado <code>ticker.py</code>, te lo vamos a pedir al final de la clase.
Comenzá creando una función que lea un archivo CSV como hiciste antes:</p>
<pre><code class="language-python"># ticker.py

from vigilante import vigilar
import csv

def parsear_datos(lines):
    rows = csv.reader(lines)
    return rows

if __name__ == '__main__':
    lines = vigilar('../Data/mercadolog.csv')
    rows = parsear_datos(lines)
    for row in rows:
        print(row)
</code></pre>
<p>Escribí una función nueva que elija algunas columnas específicas:</p>
<pre><code class="language-python"># ticker.py
...
def elegir_columnas(rows, indices):
    for row in rows:
        yield [row[index] for index in indices]
...
def parsear_datos(lines):
    rows = csv.reader(lines)
    rows = elegir_columnas(rows, [0, 2])
    return rows
</code></pre>
<p>Probalo de nuevo.
La salida ahora debería estar restringida a esto: </p>
<pre><code>['Brócoli', ' 388']
['Ajo', ' 120']
['Caqui', ' 108']
['Mandarina', ' 1170']
...
</code></pre>
<p>Escribí funciones generadoras que conviertan el tipo de datos a diccionarios:</p>
<pre><code class="language-python"># ticker.py
...

def cambiar_tipo(rows, types):
    for row in rows:
        yield [func(val) for func, val in zip(types, row)]

def hace_dicts(rows, headers):
    for row in rows:
        yield dict(zip(headers, row))

def parsear_datos(lines):
    rows = csv.reader(lines)
    rows = elegir_columnas(rows, [0, 1, 2])
    rows = cambiar_tipo(rows, [str, float, int])
    rows = hace_dicts(rows, ['nombre', 'precio', 'volumen'])
    return rows
...
</code></pre>
<p>Correlo de nuevo. Ahora la salida debería ser una serie de diccionarios:</p>
<pre><code>{'nombre': 'Frutilla', 'precio': 276.81, 'volumen': 249.0}
{'nombre': 'Morrón', 'precio': 2988.42, 'volumen': 702.0}
{'nombre': 'Morrón', 'precio': 3108.63, 'volumen': 498.0}
{'nombre': 'Naranja', 'precio': 11.5, 'volumen': 870.0}
...
</code></pre>
<h3 id="ejercicio-1011-filtremos-los-datos">Ejercicio 10.11: Filtremos los datos</h3>
<p>Para seguir agregando procesamiento a nuestro pipeline, escribí un filtro de datos:</p>
<pre><code class="language-python"># ticker.py
...

def filtrar_datos(filas, nombres):
    for fila in filas:
        if fila['nombre'] in nombres:
            yield fila
</code></pre>
<p>Esto se usa para dejar pasar únicamente aquellos lotes incluidos en el camión. Probalo.</p>
<pre><code class="language-python">
import informe
camion = informe.leer_camion('../Data/camion.csv')
filas = parsear_datos(vigilar('../Data/mercadolog.csv'))
filas = filtrar_datos(filas, camion)
for fila in filas:
    print(fila)

</code></pre>
<h3 id="ejercicio-1012-el-pipeline-ensamblado">Ejercicio 10.12: El pipeline ensamblado</h3>
<p>En el programa <code>ticker.py</code> (esta versión te vamos a pedir que la entregues) escribí una función <code>ticker(camion_file, log_file, fmt)</code> que cree un indicador en tiempo real para un camión, archivo log, y formato de tabla de salida particulares. Fijate:</p>
<pre><code class="language-python">&gt;&gt;&gt; from ticker import ticker
&gt;&gt;&gt; ticker('../Data/camion.csv', '../Data/mercadolog.csv', 'txt')
    Nombre     Precio    Volumen
---------- ---------- ----------
     Caqui     796.73         96
 Mandarina      12.12       1120
      Lima    2659.37        222
   Naranja      11.70       1040
   Durazno     281.76        704        
...

&gt;&gt;&gt; ticker('../Data/camion.csv', '../Data/mercadolog.csv', 'csv')
Nombre,Precio,Volumen
Mandarina,14.19,1140
Naranja,9.37,1150
Durazno,280.56,872
Lima,2624.94,232

...
</code></pre>
<h3 id="discusion">Discusión</h3>
<p>¿Qué aprendimos hoy? Si creás varias funciones generadoras y las ponés "en serie" (una recibe los datos de la anterior) podés crear pipelines que controlen el flujo de datos: los procesen, modifiquen o filtren entre el primer generador y el último consumidor. Además viste lo fácil que es cambiar el comportamiento del programa cuando tenés interfases bien definidas. Por supuesto, podés empaquetar un conjunto de etapas de procesamiento en una función sola, si tiene sentido hacerlo.</p>
<p><a href="../Contenidos.md">Contenidos</a> | <a href="../03_iteracion_a_medida/">Anterior (3 Iteración a medida)</a> | <a href="../05_Mas_generadores/">Próximo (5 Más sobre generadores)</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../05_Mas_generadores/" class="btn btn-neutral float-right" title="05 Mas generadores">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../03_iteracion_a_medida/" class="btn btn-neutral" title="03 iteracion a medida"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../03_iteracion_a_medida/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../05_Mas_generadores/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
