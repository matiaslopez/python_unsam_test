<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="UNSAM">
        <link rel="canonical" href="https://matiaslopez.github.io/python_unsam_test/10_Generadores_e_Iteradores/04_Producers_consumers/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>04 Producers consumers - Programación</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ABC123"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-ABC123');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="../..">Programación</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Inicio</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Unidades <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">01 - Introducción</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../01_Introduccion/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../01_Introduccion/01_Python/" class="dropdown-item">01 Python</a>
</li>
            
<li>
    <a href="../../01_Introduccion/02_Hello_world/" class="dropdown-item">02 Hello world</a>
</li>
            
<li>
    <a href="../../01_Introduccion/03_Numeros/" class="dropdown-item">03 Numeros</a>
</li>
            
<li>
    <a href="../../01_Introduccion/04_Strings/" class="dropdown-item">04 Strings</a>
</li>
            
<li>
    <a href="../../01_Introduccion/05_Listas/" class="dropdown-item">05 Listas</a>
</li>
            
<li>
    <a href="../../01_Introduccion/06_CierreClase/" class="dropdown-item">06 CierreClase</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">02 - Estructuras y funciones</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../02_Estructuras_y_Funciones/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../02_Estructuras_y_Funciones/01_Archivos/" class="dropdown-item">01 Archivos</a>
</li>
            
<li>
    <a href="../../02_Estructuras_y_Funciones/02_Funciones/" class="dropdown-item">02 Funciones</a>
</li>
            
<li>
    <a href="../../02_Estructuras_y_Funciones/03_TiposDatos/" class="dropdown-item">03 TiposDatos</a>
</li>
            
<li>
    <a href="../../02_Estructuras_y_Funciones/04_Contenedores/" class="dropdown-item">04 Contenedores</a>
</li>
            
<li>
    <a href="../../02_Estructuras_y_Funciones/05_CierreClase/" class="dropdown-item">05 CierreClase</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">03 - Trabajando con datos</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../03_Datos/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../03_Datos/01_Bugs/" class="dropdown-item">01 Bugs</a>
</li>
            
<li>
    <a href="../../03_Datos/02_Secuencias/" class="dropdown-item">02 Secuencias</a>
</li>
            
<li>
    <a href="../../03_Datos/03_Contadores/" class="dropdown-item">03 Contadores</a>
</li>
            
<li>
    <a href="../../03_Datos/04_IDE/" class="dropdown-item">04 IDE</a>
</li>
            
<li>
    <a href="../../03_Datos/05_Formato/" class="dropdown-item">05 Formato</a>
</li>
            
<li>
    <a href="../../03_Datos/06_Arboles1/" class="dropdown-item">06 Arboles1</a>
</li>
            
<li>
    <a href="../../03_Datos/07_CierreClase/" class="dropdown-item">07 CierreClase</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">04 - Algoritmos sobre listas y comprensión de listas</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../04_Listas_y_Listas/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../04_Listas_y_Listas/01_Debugger/" class="dropdown-item">01 Debugger</a>
</li>
            
<li>
    <a href="../../04_Listas_y_Listas/02_IteradoresLista/" class="dropdown-item">02 IteradoresLista</a>
</li>
            
<li>
    <a href="../../04_Listas_y_Listas/03_Comprension_Listas/" class="dropdown-item">03 Comprension Listas</a>
</li>
            
<li>
    <a href="../../04_Listas_y_Listas/04_Objetos/" class="dropdown-item">04 Objetos</a>
</li>
            
<li>
    <a href="../../04_Listas_y_Listas/05_Arboles2_LC/" class="dropdown-item">05 Arboles2 LC</a>
</li>
            
<li>
    <a href="../../04_Listas_y_Listas/06_Cierre/" class="dropdown-item">06 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">05 - Aleatoridad</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../05_Random_Plt_Dbg/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../05_Random_Plt_Dbg/01_Random/" class="dropdown-item">01 Random</a>
</li>
            
<li>
    <a href="../../05_Random_Plt_Dbg/02_NumPy_Arrays/" class="dropdown-item">02 NumPy Arrays</a>
</li>
            
<li>
    <a href="../../05_Random_Plt_Dbg/03_Figuritas/" class="dropdown-item">03 Figuritas</a>
</li>
            
<li>
    <a href="../../05_Random_Plt_Dbg/04_Arboles3_plt/" class="dropdown-item">04 Arboles3 plt</a>
</li>
            
<li>
    <a href="../../05_Random_Plt_Dbg/05_Cierre/" class="dropdown-item">05 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">06 - Complejidad y Organización de programas</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/01_Repaso/" class="dropdown-item">01 Repaso</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/02_Scripts/" class="dropdown-item">02 Scripts</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/03_Funciones/" class="dropdown-item">03 Funciones</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/04_Modulos/" class="dropdown-item">04 Modulos</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/05_BusqBinaria/" class="dropdown-item">05 BusqBinaria</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/06_Complejidad/" class="dropdown-item">06 Complejidad</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/07_gr%C3%A1ficos_de_complejidad/" class="dropdown-item">07 gráficos de complejidad</a>
</li>
            
<li>
    <a href="../../06_Organizacion_y_Complejidad/08_Cierre/" class="dropdown-item">08 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">07 - Diseño, especificación, documentación y estilo</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/01_Repaso/" class="dropdown-item">01 Repaso</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/02_Excepciones/" class="dropdown-item">02 Excepciones</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/03_Modulo_principal/" class="dropdown-item">03 Modulo principal</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/04_Flexibilidad/" class="dropdown-item">04 Flexibilidad</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/05_Especificacion_y_Documentacion/" class="dropdown-item">05 Especificacion y Documentacion</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/06_Estilo/" class="dropdown-item">06 Estilo</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/07_Matplotlib/" class="dropdown-item">07 Matplotlib</a>
</li>
            
<li>
    <a href="../../07_Plt_Especificacion_y_Documentacion/08_Cierre/" class="dropdown-item">08 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">08 - Fechas, Carpetas y Pandas</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/01_Intro/" class="dropdown-item">01 Intro</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/02_Fechas/" class="dropdown-item">02 Fechas</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/03_Archivos_y_Directorios/" class="dropdown-item">03 Archivos y Directorios</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/04_Ordenando_archivos/" class="dropdown-item">04 Ordenando archivos</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/05_Pandas/" class="dropdown-item">05 Pandas</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/06_Series_Temporales/" class="dropdown-item">06 Series Temporales</a>
</li>
            
<li>
    <a href="../../08_Fechas_Carpetas_y_Pandas/07_Cierre/" class="dropdown-item">07 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">09 - Clases y objetos</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../09_Clases_y_Objetos/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/01_Intro/" class="dropdown-item">01 Intro</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/02_Clases/" class="dropdown-item">02 Clases</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/03_Herencia/" class="dropdown-item">03 Herencia</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/04_M%C3%A9todos_Especiales/" class="dropdown-item">04 Métodos Especiales</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/05_Pilas_Colas/" class="dropdown-item">05 Pilas Colas</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/06_Teledeteccion/" class="dropdown-item">06 Teledeteccion</a>
</li>
            
<li>
    <a href="../../09_Clases_y_Objetos/07_Cierre/" class="dropdown-item">07 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">10 - Generadores e iteradores</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../01_Intro/" class="dropdown-item">01 Intro</a>
</li>
            
<li>
    <a href="../02_protocolo_Iteracion/" class="dropdown-item">02 protocolo Iteracion</a>
</li>
            
<li>
    <a href="../03_iteracion_a_medida/" class="dropdown-item">03 iteracion a medida</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">04 Producers consumers</a>
</li>
            
<li>
    <a href="../05_Mas_generadores/" class="dropdown-item">05 Mas generadores</a>
</li>
            
<li>
    <a href="../06_PredadorPresa/" class="dropdown-item">06 PredadorPresa</a>
</li>
            
<li>
    <a href="../07_Cierre/" class="dropdown-item">07 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">11 - Recursión y regresión</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../11_Recursion/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../11_Recursion/01_Introduccion/" class="dropdown-item">01 Introduccion</a>
</li>
            
<li>
    <a href="../../11_Recursion/02_Recursion/" class="dropdown-item">02 Recursion</a>
</li>
            
<li>
    <a href="../../11_Recursion/03_Diseno_Recursivo/" class="dropdown-item">03 Diseno Recursivo</a>
</li>
            
<li>
    <a href="../../11_Recursion/05_EjerciciosRec/" class="dropdown-item">05 EjerciciosRec</a>
</li>
            
<li>
    <a href="../../11_Recursion/05_Regresion_Lineal/" class="dropdown-item">05 Regresion Lineal</a>
</li>
            
<li>
    <a href="../../11_Recursion/06_Cierre/" class="dropdown-item">06 Cierre</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">12 - Ordenamiento</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../12_Ordenamiento/00_Resumen/" class="dropdown-item">00 Resumen</a>
</li>
            
<li>
    <a href="../../12_Ordenamiento/01_Introduccion/" class="dropdown-item">01 Introduccion</a>
</li>
            
<li>
    <a href="../../12_Ordenamiento/02_Ordenamiento_sencillo/" class="dropdown-item">02 Ordenamiento sencillo</a>
</li>
            
<li>
    <a href="../../12_Ordenamiento/03_Divide_and_Conquer/" class="dropdown-item">03 Divide and Conquer</a>
</li>
            
<li>
    <a href="../../12_Ordenamiento/04_introduccion_al_AA/" class="dropdown-item">04 introduccion al AA</a>
</li>
            
<li>
    <a href="../../12_Ordenamiento/05_Cierre/" class="dropdown-item">05 Cierre</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Buscar
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../03_iteracion_a_medida/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Anterior
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../05_Mas_generadores/" class="nav-link">
                                    Siguiente <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Tabla de contenidos">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#104-productores-consumidores-y-canerias" class="nav-link">10.4 Productores, consumidores y cañerías.</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#sistemas-productor-consumidor" class="nav-link">Sistemas productor-consumidor</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#pipelines-con-generadores" class="nav-link">Pipelines con generadores</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ejercicios" class="nav-link">Ejercicios</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#ejercicio-108-configuremos-un-pipeline-simple" class="nav-link">Ejercicio 10.8: Configuremos un pipeline simple</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#ejercicio-109-un-pipeline-mas-en-serio" class="nav-link">Ejercicio 10.9: Un pipeline más en serio</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#ejercicio-1010-un-pipeline-mas-largo" class="nav-link">Ejercicio 10.10: Un pipeline más largo</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#ejercicio-1011-filtremos-los-datos" class="nav-link">Ejercicio 10.11: Filtremos los datos</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#ejercicio-1012-el-pipeline-ensamblado" class="nav-link">Ejercicio 10.12: El pipeline ensamblado</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#discusion" class="nav-link">Discusión</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="../Contenidos.md">Contenidos</a> | <a href="../03_iteracion_a_medida/">Anterior (3 Iteración a medida)</a> | <a href="../05_Mas_generadores/">Próximo (5 Más sobre generadores)</a></p>
<h1 id="104-productores-consumidores-y-canerias">10.4 Productores, consumidores y cañerías.</h1>
<p>Para esta sección hay un <a href="https://youtu.be/CSFc1Z__1hA">video introductorio</a>.</p>
<p>Los generadores son una herramienta muy útil para configurar pipelines (cañerías). Este concepto requiere una breve <em>aclaración</em>: Un pipeline tradicional en computación consta de una serie de programas y archivos asociados que constituyen una estructura de procesamiento de datos, donde cada programa se ejecuta independientemente de los demás, pero juntos resultan en un flujo conveniente de datos a través de los archivos asociados desde un "productor" (una cámara, un sensor, un lector de código de barras) hasta un "consumidor" (un graficador, un interruptor eléctrico, un log de una página web). Construiste un pequeño pipeline en la sección anterior, usando <code>vigilante.py</code>.  </p>
<p>En esta sección hablaremos de cómo implementar estas estructuras de productores y consumidores de datos con generadores en Python.</p>
<h3 id="sistemas-productor-consumidor">Sistemas productor-consumidor</h3>
<p>El concepto de generadores está íntimamente asociado a problemas de tipo productor-consumidor en sus varias formas. Fijate esta estructura, que es típica de muchos programas:</p>
<pre><code class="language-python"># Productor
def vigilar(f):
    ...
    while True:
        ...
        yield linea        # Produce/obtiene valores para &quot;linea&quot;
        ...

# Consumidor
for linea in vigilar(f):    # Consume líneas del `yield`
    ...
</code></pre>
<p>Los <code>yield</code> generan los datos que los <code>for</code> consumen.</p>
<h3 id="pipelines-con-generadores">Pipelines con generadores</h3>
<p>Podés usar esta característica de los generadores para construír <em>pipelines</em> que procesen tus datos, un concepto que es muy usado en Unix (pipes) pero en Windows se usa menos.</p>
<p><em>productor</em> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <em>consumidor</em></p>
<p>Los <em>pipelines</em> de procesamiento de datos tienen un productor al comienzo, una cadena de etapas de procesamiento y un consumidor al final.</p>
<p><strong>productor</strong> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <em>consumidor</em></p>
<pre><code class="language-python">def productor():
    ...
    yield item
    ...
</code></pre>
<p>El productor es en general un generador, aunque tambien podría ser una lista o cualquier otra secuencia iterable.</p>
<p>El <code>yield</code> alimenta al pipeline de datos.</p>
<p><em>productor</em> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <strong>consumidor</strong></p>
<pre><code class="language-python">def consumidor(s):
    for item in s:
        ...
</code></pre>
<p>El consumidor es un ciclo <code>for</code>. Obtiene los elementos <code>item</code> y los usa para algo.</p>
<p><em>productor</em> &rarr; <strong>procesamiento</strong> &rarr; <strong>procesamiento</strong> &rarr; <em>consumidor</em></p>
<pre><code class="language-python">def procesamiento(s):
    for item in s:
        ...
        yield itemnuevo
        ...
</code></pre>
<p>Las etapas intermedias de procesamiento simultáneamente consumen y producen datos, pueden alterar el flujo de datos, eliminar o modificar datos según su función.</p>
<p><em>productor</em> &rarr; <em>procesamiento</em> &rarr; <em>procesamiento</em> &rarr; <em>consumidor</em></p>
<pre><code class="language-python">def productor():
    ...
    yield item          # yield devuelve un item que será recibido por `procesamiento`
    ...

def procesamiento(s):
    for item in s:      # item viene del `productor`
        ...
        yield newitem   # este yield devuelve un nuevo item
        ...

def consumidor(s):
    for item in s:      # item viene de `procesamiento`
        ...
</code></pre>
<p>Vamos a construír un pipeline con la siguiente arquitectura:</p>
<pre><code class="language-python">a = productor()
b = procesamiento(a)
c = consumidor(b)
</code></pre>
<p>Como te darás cuenta, los datos van pasando de una función a la siguiente.</p>
<h2 id="ejercicios">Ejercicios</h2>
<p>Para este ejercicio, necesitás que el programa <code>sim_mercado.py</code> aún esté corriendo. Vas a usar la función <code>vigilar()</code> que escribiste en el <a href="../03_iteracion_a_medida/#ejercicio-107-cambios-de-precio-de-un-camión">Ejercicio 10.7</a></p>
<h3 id="ejercicio-108-configuremos-un-pipeline-simple">Ejercicio 10.8: Configuremos un pipeline simple</h3>
<p>Escribí la siguiente función y veamos como funciona un pipeline.</p>
<pre><code class="language-python">&gt;&gt;&gt; def filematch(lines, substr):
        for line in lines:
            if substr in line:
                yield line

&gt;&gt;&gt;
</code></pre>
<p>Esta función es casi idéntica al primer ejemplo de generador en el ejercicio anterior, salvo que ya no abre un archivo sino que opera directamente de una secuencia de líneas que recibe como argumento. Ahora probá lo siguiente:</p>
<pre><code class="language-python">&gt;&gt;&gt; lines = vigilar('../Data/mercadolog.csv')
&gt;&gt;&gt; naranjas = filematch(lines, 'Naranja')
&gt;&gt;&gt; for line in naranjas:
        print(line)

... esperá que aparezca la salida ...
</code></pre>
<p>Puede pasar que tarde unos segundos en darte una salida, pero vas a ver información sobre naranjas tan pronto como sean añadidas al archivo por el primer generador.</p>
<h3 id="ejercicio-109-un-pipeline-mas-en-serio">Ejercicio 10.9: Un pipeline más en serio</h3>
<p>Llevemos esta idea un poco más lejos. Probemos esto:</p>
<pre><code class="language-python">&gt;&gt;&gt; from vigilante import vigilar
&gt;&gt;&gt; import csv
&gt;&gt;&gt; lineas = vigilar('../Data/mercadolog.csv')
&gt;&gt;&gt; filas = csv.reader(lineas)
&gt;&gt;&gt; for fila in filas:
        print(fila)

...   
['Rabanito', ' 249.37', ' 357']
['Batata', ' 15.75', ' 1040']
['Rabanito', ' 211.31', ' 324']
['Zuccini', ' 83.12', ' 612']
...
</code></pre>
<p>¡Interesante!  La salida de la función <code>vigilar()</code> fué usada como entrada a la función <code>csv.reader()</code> (que habíamos usado para leer un archivo del disco) y el resultado es una secuencia de filas "parseadas", separadas por las comas. </p>
<h3 id="ejercicio-1010-un-pipeline-mas-largo">Ejercicio 10.10: Un pipeline más largo</h3>
<p>Veamos si podemos construír un pipeline más largo basado en la misma idea.</p>
<p>Creá un archivo nuevo llamado <code>ticker.py</code>, te lo vamos a pedir al final de la clase.
Comenzá creando una función que lea un archivo CSV como hiciste antes:</p>
<pre><code class="language-python"># ticker.py

from vigilante import vigilar
import csv

def parsear_datos(lines):
    rows = csv.reader(lines)
    return rows

if __name__ == '__main__':
    lines = vigilar('../Data/mercadolog.csv')
    rows = parsear_datos(lines)
    for row in rows:
        print(row)
</code></pre>
<p>Escribí una función nueva que elija algunas columnas específicas:</p>
<pre><code class="language-python"># ticker.py
...
def elegir_columnas(rows, indices):
    for row in rows:
        yield [row[index] for index in indices]
...
def parsear_datos(lines):
    rows = csv.reader(lines)
    rows = elegir_columnas(rows, [0, 2])
    return rows
</code></pre>
<p>Probalo de nuevo.
La salida ahora debería estar restringida a esto: </p>
<pre><code>['Brócoli', ' 388']
['Ajo', ' 120']
['Caqui', ' 108']
['Mandarina', ' 1170']
...
</code></pre>
<p>Escribí funciones generadoras que conviertan el tipo de datos a diccionarios:</p>
<pre><code class="language-python"># ticker.py
...

def cambiar_tipo(rows, types):
    for row in rows:
        yield [func(val) for func, val in zip(types, row)]

def hace_dicts(rows, headers):
    for row in rows:
        yield dict(zip(headers, row))

def parsear_datos(lines):
    rows = csv.reader(lines)
    rows = elegir_columnas(rows, [0, 1, 2])
    rows = cambiar_tipo(rows, [str, float, int])
    rows = hace_dicts(rows, ['nombre', 'precio', 'volumen'])
    return rows
...
</code></pre>
<p>Correlo de nuevo. Ahora la salida debería ser una serie de diccionarios:</p>
<pre><code>{'nombre': 'Frutilla', 'precio': 276.81, 'volumen': 249.0}
{'nombre': 'Morrón', 'precio': 2988.42, 'volumen': 702.0}
{'nombre': 'Morrón', 'precio': 3108.63, 'volumen': 498.0}
{'nombre': 'Naranja', 'precio': 11.5, 'volumen': 870.0}
...
</code></pre>
<h3 id="ejercicio-1011-filtremos-los-datos">Ejercicio 10.11: Filtremos los datos</h3>
<p>Para seguir agregando procesamiento a nuestro pipeline, escribí un filtro de datos:</p>
<pre><code class="language-python"># ticker.py
...

def filtrar_datos(filas, nombres):
    for fila in filas:
        if fila['nombre'] in nombres:
            yield fila
</code></pre>
<p>Esto se usa para dejar pasar únicamente aquellos lotes incluidos en el camión. Probalo.</p>
<pre><code class="language-python">
import informe
camion = informe.leer_camion('../Data/camion.csv')
filas = parsear_datos(vigilar('../Data/mercadolog.csv'))
filas = filtrar_datos(filas, camion)
for fila in filas:
    print(fila)

</code></pre>
<h3 id="ejercicio-1012-el-pipeline-ensamblado">Ejercicio 10.12: El pipeline ensamblado</h3>
<p>En el programa <code>ticker.py</code> (esta versión te vamos a pedir que la entregues) escribí una función <code>ticker(camion_file, log_file, fmt)</code> que cree un indicador en tiempo real para un camión, archivo log, y formato de tabla de salida particulares. Fijate:</p>
<pre><code class="language-python">&gt;&gt;&gt; from ticker import ticker
&gt;&gt;&gt; ticker('../Data/camion.csv', '../Data/mercadolog.csv', 'txt')
    Nombre     Precio    Volumen
---------- ---------- ----------
     Caqui     796.73         96
 Mandarina      12.12       1120
      Lima    2659.37        222
   Naranja      11.70       1040
   Durazno     281.76        704        
...

&gt;&gt;&gt; ticker('../Data/camion.csv', '../Data/mercadolog.csv', 'csv')
Nombre,Precio,Volumen
Mandarina,14.19,1140
Naranja,9.37,1150
Durazno,280.56,872
Lima,2624.94,232

...
</code></pre>
<h3 id="discusion">Discusión</h3>
<p>¿Qué aprendimos hoy? Si creás varias funciones generadoras y las ponés "en serie" (una recibe los datos de la anterior) podés crear pipelines que controlen el flujo de datos: los procesen, modifiquen o filtren entre el primer generador y el último consumidor. Además viste lo fácil que es cambiar el comportamiento del programa cuando tenés interfases bien definidas. Por supuesto, podés empaquetar un conjunto de etapas de procesamiento en una función sola, si tiene sentido hacerlo.</p>
<p><a href="../Contenidos.md">Contenidos</a> | <a href="../03_iteracion_a_medida/">Anterior (3 Iteración a medida)</a> | <a href="../05_Mas_generadores/">Próximo (5 Más sobre generadores)</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentación construida con <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Buscar</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>
            </div>
            <div class="modal-body">
                <p>Desde aquí puede buscar estos documentos. Ingrese sus términos de búsqueda a continuación.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Buscando..." id="mkdocs-search-query" title="Escriba el término de búsqueda aquí">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No se encontraron resultados"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Atajos de teclado</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Teclas</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Abrir esta ayuda</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Página siguiente</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Página anterior</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Buscar</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
